[uBlock Origin 1.14.11]
! Title: GelboLube (Legacy)
! Version: 201710231333
! Author: kowith337
! Expires: 2 days
! Homepage: https://github.com/kowith337/PersonalFilterListCollection
! From: https://github.com/kowith337/GelboLube/raw/legacy/gelbolube.txt

! 1. It doesn't matter to have any checksum tools because uBo is now fully support filterlists that created on GitHub
!    and regularly auto check itself when it's outdated more than 2 days.
! 2. This rules not completely to hide ads and collapse space, but it still remove ads and unwanted resources.
!    (e.g. subdocuments and other scripts file that no need to load them)
! 3. Author/Owner/Contributor of gelbooru.com will frequently update their sites to keep ads appear.
! 4. for Chromium, uB0 WebExtension, Firefox 57+ users, you can move to normal version at your own risk! because blocking
!    ExoLoader function is also prevent 'lazyload' to be execute, I've allowed them because I have no choice (right now)

! - - - - - - - - - - Generic - - - - - - - - - - !
! Block external hyperlinks, include CCBill ads and Patreon.
! gelbooru.com##.content #nup
! gelbooru.com##.sidebar #tup
! gelbooru.com##a#ext
! gelbooru.com##a.ext
gelbooru.com###paginater a:has(img)
gelbooru.com###pagination a:has(img)
gelbooru.com###paginator a:has(img)
gelbooru.com##.paginater a:has(img)
gelbooru.com##.pagination a:has(img)
gelbooru.com##.paginator a:has(img)
gelbooru.com##a[href*="click.php"]
gelbooru.com##a[href*="media.r18"]
gelbooru.com##a[href*="mnfclub.com"]
gelbooru.com##a[rel="nofollow"] video

! Block ExoClick iFrame (Not sure is it still exist?)
gelbooru.com##iframe[src*="exoclick"]

! Leftover ad space above of image list / image view
gelbooru.com##.contain-push .hidden-xs[style*="max-width: 728px"]

! Trying to block NoScript
gelbooru.com##noscript

! - - - - - - - - - - Filtered specific hiding - - - - - - - - - - !
! 1. [Deprecated by lazyload] Now they replace all legitmate posts link (clickable image list thumbnails) with tracked/redirected links to
!    mess the hyperlink blocking, I've adjusted with "if-not" to make sure it doesn't accidentally remove legitmate thumbnails again
!    to prevent popped out new tab/window to show ads sites separately.
!    Note: only advert images that not loaded from specific location will be work, e.g. (//assets.gelbooru.com/thumbnails/**/**/thumbnail_...)
! gelbooru.com##a[href*="redirect.php"]:if-not(img[src*="/thumbnail_"])
! gelbooru.com###post-list #content a[href*="redirect.php"]:if-not(img[src*="/thumbnail_"])

! 2. To block hyperlink ads that appear under the tag lists (currently know it's promote r18.com and jabcomix.com)
gelbooru.com##div[class^="sidebar"] a[target]:has(img)

! 3. [Deprecated by New Ad code] To hide placeholder that reserved for advert banner under the page number.
!    I don't think this rule will be work anymore, but just in case if they re-use this.
! gelbooru.com##div[style*="width:1000px"]:has(script)

! Block Every videos, subdocs and scripts (See Unbreak for exception)
||gelbooru.com$media
||gelbooru.com$script
||gelbooru.com$subdocument

! - - - - - - - - - - Unbreak - - - - - - - - - - !
! 1. Allow jQuery from GoogleAPIs and BootStrap (suggested by toshiya44)
@@||ajax.googleapis.com/ajax/libs/jquery/*$script,domain=gelbooru.com
@@||bootstrapcdn.com/bootstrap/*$script,domain=gelbooru.com
@@||gelbooru.com/script/jquery*$script,first-party

! 2. Core scripts, but 'application.js' is questionable due to it's have "ExoLoader" function inside that script.
@@||gelbooru.com/script/application.js|$script,first-party
@@||gelbooru.com/script/application.js?$script,first-party
@@||gelbooru.com/script/miscJs.js|$script,first-party
@@||gelbooru.com/script/miscJs.js?$script,first-party
@@||gelbooru.com/script/try.js|$script,first-party
@@||gelbooru.com/script/try.js?$script,first-party

! 3. Actual WebM Videos (Legitmate WebM vids are loaded from /images/ only, otherwise is adverts!)
@@||gelbooru.com/images/$media
@@||gelbooru.com//images/$media

! 4. Legitmate thumbnails conclusion
!       a. Blame to Gelbooru's false that place advert images into "/0A/" (now they use "/0C/")
!       b. some filterlists blocking part of "/ad/"
!    Note: all thumbnails are loaded as jpg files and have image id assigned after ?, ex. (thumbnail_8486c668859b0821a69336448abc5340.jpg?3618398)
@@||gelbooru.com/thumbnails/*/*/thumbnail_*.jpg$image
@@||gelbooru.com/thumbnails/*/*/thumbnail_*.jpg?$image

! 5. Honeypot script that deploy specific value to check, if users block all scripts (or use noscript),
!    a few code of inline-script will triggered to show ads under page number again.
!    Note: Althought, I didn't see they use "youhate.us" domain long time ago, I've seen once when downloading full size image
!          while connections is too slow to load image directly from Gelbooru domain.
@@||gelbooru.com/ads.js?$script
@@||youhate.us/ads.js?$script

! 6. Allow lazyload script to be loaded because function to load thumbnail is depend on this, since today's update (2017/10/03)
@@||gelbooru.com/script/lazyload.js?$script,first-party

! Unused
! @@||gelbooru.com/script/jqueryMisc.js|$script
! @@||gelbooru.com/script/jqueryNotes.js|$script
! @@||gelbooru.com/script/jqueryPools.js|$script
! @@||gelbooru.com/script/jqueryPosts.js|$script
! @@||gelbooru.com/script/jqueryScrollTo.js|$script
! @@||gelbooru.com/script/jqueryTimeout.js|$script
! @@||gelbooru.com/script/jquery-ui.min.js|$script
! Note: inserted `|` to prevent the foolish exception exploit.

! - - - - - - - - - - Counter other filterlists - - - - - - - - - - !
! 1. Counter uBlock Assets that's block inline-script, the purpose is my filter still block some bad scripts and internal function,
!    such as prevent ExoLoader function to execute and deploy cookie, prevent read ILS ads check function, block GoogleAnalyticsObject, ...
||gelbooru.com$inline-script,badfilter

! 2. Counter uBlock Assets that's allow script from first party domains entirely, I cannot predict the possibility about when they placed
!    hostile scripts at top level or somewhere else, only allow scripts from '/script/' is still safe for now...
@@||gelbooru.com^$first-party,script,badfilter

! 3. Counter EasyList and/or Fanboy lists (Esp. Enhanced tracking OR Ultimate / What are they doing right now?)
! - Block every script at every domains to be loaded, but the main problem is they still whitelist ExoClick, I don't know why?
! - Resized and/or Full image(s) was blocked, due to Gelbooru move all images to 'gelbooru.com' instead of 'assets.gelbooru.com'
! - Allowing all '/thumbnails/' images mean also allow ads images that located at same path to be loaded.
@@||assets.gelbooru.com/thumbnails/$image,badfilter
|http://$script,domain=gelbooru.com,badfilter
|https://$script,domain=gelbooru.com,badfilter
||gelbooru.com^$first-party,image,badfilter

! - - - - - - - - - - Strict blocking - - - - - - - - - - !
! 1. Third party their use to serve ads and track users.
!    Now using $important tag due to counter EasyList filters that whitelist ExoClick script ads.
||4uvjosuc.com$domain=gelbooru.com|thedoujin.com,important
||adnium.com$domain=gelbooru.com|thedoujin.com,important
||contentabc.com$domain=gelbooru.com|thedoujin.com,important
||ccbill.com$domain=gelbooru.com|thedoujin.com,important
||dynsrvaba.com$domain=gelbooru.com|thedoujin.com,important
||exoclick.com$domain=gelbooru.com|thedoujin.com,important
||exosrv.com$domain=gelbooru.com|thedoujin.com,important
||google-analytics.com$domain=gelbooru.com|thedoujin.com,important
||jabcomix.com$domain=gelbooru.com|thedoujin.com,important
||juicyads.com$domain=gelbooru.com|thedoujin.com,important
||mnfclub.com$domain=gelbooru.com|thedoujin.com,important
||r18.com$domain=gelbooru.com|thedoujin.com,important
||tsyndicate.com$domain=gelbooru.com|thedoujin.com,important
||twitter.com$domain=gelbooru.com|thedoujin.com,important
||verotel.com$domain=gelbooru.com|thedoujin.com,important

! 2. Block "r18.com" promo, /r18/ strict!
||gelbooru.com/r18/$important

! 3. Block "JabComix" promo, /r19/ strict!
||gelbooru.com/r19/$important

! 4. [Deprecated by Unbreak #2] Block "application.js" that not have "?" remark after, in case if they move everything to jQuery.
!    (But I think they not do it again because of [http://gelbooru.com/index.php?page=forum&s=view&id=3716])
! ||gelbooru.com/script/application.js|$script,important

! 5. Block hostile scripts that load as php, it's an ad script that foolish exception rule and loaded as php doc.
||gelbooru.com/bed.php$important
||gelbooru.com/script/application.js.php$important
||gelbooru.com/script/bed.php$important

! 6. Block advert images (currently placed as /thumbnails/0A, they may change location and/or filename, but legitmate thumbnail will have ? referrer after.)
!    Now reduce priority for [*.jpg] due to it's use for other appearance, such as recent comments that load thumbnail images without ?<PostID> referrer.
!    Also prevent repetitive requests that their currently using, like request as "other" type instead of original one.
||gelbooru.com/thumbnails/*.jpg|
||gelbooru.com/thumbnails/*.gif|$important
||gelbooru.com/thumbnails/*.png|$important

! 7. Block "v.php" XHR, Don't know what it does, but I think it's maybe the cause of deploying CloudFlare session cookie. (__cfduid)
||gelbooru.com/v.php$xmlhttprequest,important

! 8. To preventing resources request abuse that they trying to reload as 'other' for able to re-access blocked JavaScript function.
||gelbooru.com/ads.js$~script,important
||gelbooru.com/script/application.js$~script,important
||youhate.us/ads.js$~script,important
||gelbooru.com/*.php*$~document,~inline-script,~xmlhttprequest
||gelbooru.com/*.php?$~document,~inline-script,~xmlhttprequest

! 9. Useless scripts that fooled to seems like it's useful, but the real thing is for using with new method of popunder ads! (for sure)
||gelbooru.com/script/license$important
! ||gelbooru.com/script/miscJs$important

! - - - - - - - - - - Inject Scriptlets - - - - - - - - - - !
! 1. Block attempt to rewrite adverts under paginator via reading some value, doing this also stop advert images requests.
!    Note: they bypassed this block by rename function like [advertVar > abvertDar], this solution will not be last long enough.
gelbooru.com##script:inject(abort-on-property-read.js, abvertDar)
gelbooru.com##script:inject(abort-on-property-read.js, advertVar)

! 2. Stop exo_zones cookie deploy as first party, the ExoLoader function was called from application.js that whitelisted to unbreak site functional.
!    Update: due to new update on Gelbooru was using the lazyload function to load all thumbnails, these rules will be halt
!            until found a better solution to keep preventing ExoLoader wrote cookies on local storage as 1st-party.
!    Update 2: They change the script name, likely they do in the fallback ILS to execute and re-deploy ads if some ads value was forbidden
gelbooru.com,thedoujin.com##script:inject(abort-on-property-write.js, fuckingnormieswryyyy)
gelbooru.com,thedoujin.com##script:inject(abort-on-property-write.js, fuckingnormieswryyyy.addZone)
gelbooru.com,thedoujin.com##script:inject(abort-on-property-write.js, fuckingnormieswryyyy.serve)
gelbooru.com,thedoujin.com##script:inject(abort-on-property-write.js, ExoDetector)
gelbooru.com,thedoujin.com##script:inject(abort-on-property-write.js, ExoDetector.domain_base)
gelbooru.com,thedoujin.com##script:inject(abort-on-property-write.js, ExoLoader)
gelbooru.com,thedoujin.com##script:inject(abort-on-property-write.js, ExoLoader.addZone)
gelbooru.com,thedoujin.com##script:inject(abort-on-property-write.js, ExoLoader.serve)

! 3. [Deprecated] Prevent data collector from adnium.com to write script
! gelbooru.com,thedoujin.com##script:inject(abort-on-property-write.js, adnOpt)

! 4. Prevent Google Analytics to be executed, but it works only inline script due to they recently add asynchronous script after document loaded.
!    Tested this injection rules and this won't break the site.
gelbooru.com,thedoujin.com##script:inject(abort-on-property-write.js, GoogleAnalyticsObject)

! 5. Prevent JuicyAds execute, same behavior as Google Analytics
gelbooru.com,thedoujin.com##script:inject(abort-on-property-write.js, adsbyjuicy)

! 6. New BetterJsPop popunder that currently testing to show thedoujin site as popunder,
!    a same method that how ExoClick serving ads.
gelbooru.com##script:inject(abort-on-property-write.js, BetterJsPop)

! 7. Experimental, I don't know how it does and how to use properly.
gelbooru.com,thedoujin.com##script:inject(abort-current-inline-script.js, ad_idzone, ad_width, ad_height, ad_tags)
gelbooru.com,thedoujin.com##script:inject(abort-current-inline-script.js, document.addEventListener, abvertDar)
gelbooru.com,thedoujin.com##script:inject(abort-current-inline-script.js, fuckingnormieswryyyy.domain_base)
gelbooru.com,thedoujin.com##script:inject(abort-current-inline-script.js, fuckingnormieswryyyy.addZone)
gelbooru.com,thedoujin.com##script:inject(abort-current-inline-script.js, fuckingnormieswryyyy.serve)
gelbooru.com,thedoujin.com##script:inject(abort-current-inline-script.js, BetterJsPop.add)
gelbooru.com,thedoujin.com##script:inject(abort-current-inline-script.js, ExoDetector.domain_base)
gelbooru.com,thedoujin.com##script:inject(abort-current-inline-script.js, ExoLoader.addZone)
gelbooru.com,thedoujin.com##script:inject(abort-current-inline-script.js, ExoLoader.serve)

! - - - - - - - - - - CSS / Mobile Improvement - - - - - - - - - - !
! Remove alert bar and adjusting header menu position to use half screen of each instead of stacking
! because it ate up space almost half of screen from top.
! This will surely conflict when you request desktop view or when you're already use desktop browser.
gelbooru.com##.alert-info:has(a[href*="?page=ihnt"])
gelbooru.com##.alert-warning:has(a[href*="javascript"])
gelbooru.com##.navbar#submenu #navbar2 .navbar-nav:style(direction:rtl !important)
gelbooru.com##.navbar#submenu #navbar2:style(float: right !important)
gelbooru.com##.navbar#submenu:style(float: right !important; width: 50% !important)
gelbooru.com##.navbar.navbar-default .navbar-brand:style(display: none !important)
gelbooru.com##.navbar.navbar-default .navbar-header button.navbar-toggle:style(float:left !important; margin-left: 10px !important; margin-right: 0px !important)
gelbooru.com##.navbar.navbar-default:style(float: left; width: 50% !important)
! gelbooru.com###post-view #right-col div #image[src*="sample"]:style(width: 100% !important)

! Use 'matches-css' to remove placeholder after allowed 'ExoLoader.addZone' to generate advert space
! that's mean because they hard coded to load that function along with lazyload
gelbooru.com##center div:matches-css(width: 300px)

! - - - - - - - - - - Firefox + uBO Legacy Only - - - - - - - - - - !
! ##script rules are work only uBlock0 1.2.0 + Firefox 42 or newer (Fennec F-Droid also work, Not sure for IceCat and Pale Moon because it based on ESR build)
! - I can confirmed these inline script filter rules below can collaps space that caused from every immoral ads, for now.
! - Only the legacy version of uBlock Origin can be used these rules, the legacy version will be no longer release and get updated
!   when stable version of Firefox 57 released, or maybe need someone to clone and port to keep extended support for legacy version.
! - Keep in mind because they may rename some function to survive blocking, such as change [advertVar] to [abvertDar]
gelbooru.com##script:contains(_gaq.push)
gelbooru.com##script:contains(abvertDar)
gelbooru.com##script:contains(ad_idzone)
gelbooru.com##script:contains(adsbyjuicy)
gelbooru.com##script:contains(advertVar)
gelbooru.com##script:contains(fuckingnormieswryyyy.serve)
gelbooru.com##script:contains(ExoDetector)
gelbooru.com##script:contains(ExoLoader.serve)
gelbooru.com##script:contains(trw_domain)
gelbooru.com##script:contains(BetterJsPop)
gelbooru.com##script:contains(GoogleAnalyticsObject)
! gelbooru.com##script:contains(adnOpt)

! - - - - - - - - - - For TheDouJin - - - - - - - - - - !
! Block all script same as Gelbooru, but only allow scripts from /assets because need for unbreak jQuery.
||thedoujin.com$script,subdocument
@@||thedoujin.com/assets/$script

! Currently support to remove ads space leftover for firefox only because most inline-script ads are shared from Gelbooru.
! Otherwise, using element hiding rules will be hide something important, e.g. tags.
thedoujin.com##.adnSpot
thedoujin.com##.boxTopLocContent center:if(div:matches-css(width: 300px))
thedoujin.com##.boxTopLocContent center:if(div:matches-css(width: 728px))
thedoujin.com##.container[style="text-align: center;"] div:matches-css(width: 300px)
thedoujin.com##noscript
thedoujin.com##script:contains(_gaq.push)
thedoujin.com##script:contains(ad_idzone)
thedoujin.com##script:contains(adnOpt)
thedoujin.com##script:contains(ExoLoader)